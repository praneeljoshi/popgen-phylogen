import os
import pickle
import networkx as nx
from parse_rich_newick2 import parse_rich_newick
from admixture_network import generate_ms_command, add_BirthDeath_time_tags, strip_extra_root
from call_ms import call_ms
from write_GTmix_input import write_GTmix_input
from write_TreeMix_input import write_TreeMix_input
from write_PhyloNet_input import write_input, build_bimarker_nexus, build_MCMC_BiMarkers_input, build_MLE_BiMarkers_input

def create_dir(path):
    """
    Creates a directory if it does not already exist.
    """
    if not os.path.exists(path):
        os.makedirs(path)
    return

manual_network_strings = [
    [
        #"(((B:0.0)#H1:0.05::0.8,(C:0.002,#H1:0.002::0.2):0.048):0.01,A:0.06);",
        "(Z:100.0,((((M:1.2,N:1.2)S14:0.528,K:1.728)S5:8.971320537907197,(((H:2.48832,G:2.48832)S11:1.8114969599999995,(F:2.9859839999999997,E:2.9859839999999997)S10:1.3138329599999996)S6:4.616283488255998,((((J:2.0736,I:2.0736)S12:1.5095807999999997,(L:1.44,(P:1.0,O:1.0)S15:0.43999999999999995)S13:2.1431807999999997)S9:1.5765995519999998,D:5.159780351999999)S8:1.0319560703999997,C:6.191736422399999)S7:2.7243640258559987)S4:1.7832200896511985)S3:2.139864107581438,(A:7.430083706879999,B:7.430083706879999)S2:5.409100938608636)S1:87.16081535451137);",
        "(Z:100.0,((((E:2.9859839999999997,F:2.9859839999999997)S8:4.4440997068799994,((N:1.2,M:1.2)S15:0.528,J:1.728)S7:5.702083706879999)S6:1.486016741375999,((H:2.0736,I:2.0736)S11:3.0861803519999995,((K:1.44,L:1.44)S14:1.04832,G:2.48832)S12:2.6714603519999995)S5:3.7563200962559984)S3:3.9230841972326367,((((P:1.0,O:1.0)S13:3.2998169599999994,B:4.299816959999999)S10:1.8919194623999998,(D:3.5831807999999996,C:3.5831807999999996)S9:2.6085556223999995)S4:4.507584115507197,A:10.699320537907196)S2:2.139864107581438)S1:87.16081535451137);",
        "(Z:100.0,((((N:6.191736422399999,B:6.191736422399999)S15:1.2383472844799996,((O:1.0,P:1.0)S14:2.5831807999999996,D:3.5831807999999996)S13:3.846902906879999)S12:1.486016741375999,(C:5.159780351999999,(((G:2.0736,(I:1.728,H:1.728)S11:0.3455999999999999)S10:0.9123839999999999,(J:1.44,K:1.44)S9:1.5459839999999998)S8:1.3138329599999996,(M:1.2,L:1.2)S7:3.099816959999999)S6:0.859963392)S5:3.7563200962559984)S4:3.9230841972326367,(A:10.699320537907196,(F:2.48832,E:2.48832)S3:8.211000537907196)S2:2.139864107581438)S1:87.16081535451137);",
        "(Z:100.0,(((E:2.9859839999999997,((L:1.44,K:1.44)S15:0.6335999999999999,H:2.0736)S14:0.9123839999999999)S9:3.2057524223999994,(G:2.48832,F:2.48832)S8:3.7034164223999992)S2:6.647448223088635,((A:8.916100448255998,((C:4.299816959999999,(D:3.5831807999999996,(J:1.728,I:1.728)S13:1.8551807999999996)S12:0.7166361599999997)S11:0.859963392,(O:1.0,P:1.0)S10:4.159780351999999)S6:3.7563200962559984)S5:1.7832200896511985,(B:7.430083706879999,(N:1.2,M:1.2)S7:6.230083706879999)S4:3.2692368310271975)S3:2.139864107581438)S1:87.16081535451137);"
    ],
    [
        "(Z:100.0,(((((E:4.299816959999999)#H1:3.1302667468799994::0.4,(D:5.159780351999999,#H1:0.859963392::0.6)S16:2.2703033548799993)S15:3.2692368310271975,(F:3.5831807999999996,(H:2.9859839999999997,G:2.9859839999999997)S14:0.5971967999999999)S13:7.116139737907197)S12:2.139864107581438,A:12.839184645488634)S11:5.649241244014997,(((M:1.2,N:1.2)S4:0.24,L:1.44)S3:13.967021574586362,(((((O:1.0,P:1.0)S10:0.728,K:1.728)S9:0.3455999999999999,J:2.0736)S8:0.41472,I:2.48832)S7:6.427780448255998,(C:6.191736422399999,B:6.191736422399999)S6:2.7243640258559987)S5:6.490921126330363)S2:3.08140431491727)S1:81.51157411049637);",
        "(Z:100.0,(A:18.48842588950363,(((((K:1.728,L:1.728)S13:4.463736422399999,B:6.191736422399999)S12:1.2383472844799996,(M:1.44,(N:1.2)#H1:0.24::0.4)S11:5.990083706879998)S10:1.486016741375999,(#H1:3.9597803519999992::0.6,((J:2.0736,I:2.0736)S15:1.5095807999999997,E:3.5831807999999996)S14:1.5765995519999998)S9:3.7563200962559984)S3:6.490921126330363,((((H:2.48832,G:2.48832)S16:0.4976639999999999,F:2.9859839999999997)S8:7.713336537907196,(O:1.0,P:1.0)S7:9.699320537907196)S6:2.139864107581438,(C:4.299816959999999,D:4.299816959999999)S5:8.539367685488635)S4:2.5678369290977265)S2:3.08140431491727)S1:81.51157411049637);",
        "(Z:100.0,(((C:7.430083706879999,((N:1.2,M:1.2)S13:2.3831808)#H1:3.846902906879999::0.4)S7:3.2692368310271975,A:10.699320537907196)S2:7.789105351596435,(((((P:1.0,O:1.0)S16:0.728,J:1.728)S14:1.2579839999999998,(K:1.44,L:1.44)S15:1.5459839999999998)S11:2.1737963519999997,(G:2.48832,F:2.48832)S10:2.6714603519999995)S4:10.24724122258636,(((((H:2.0736,I:2.0736)S12:2.2262169599999995,E:4.299816959999999)S9:1.8919194623999998,D:6.191736422399999)S8:2.7243640258559987,B:8.916100448255998)S6:3.9230841972326367,#H1:9.256003845488635::0.6)S5:2.5678369290977265)S3:3.08140431491727)S1:81.51157411049637);",
        "(Z:100.0,((((((C:7.430083706879999,(D:6.191736422399999,(J:1.728,(K:1.44,L:1.44)S16:0.28800000000000003)S8:4.463736422399999)S7:1.2383472844799996)S6:1.486016741375999,(E:5.159780351999999,(((((P:1.0,O:1.0)S15:1.0735999999999999,(N:1.2,M:1.2)S14:0.8735999999999999)S13:0.41472,I:2.48832)S12:0.4976639999999999,H:2.9859839999999997)S11:1.3138329599999996,(F:3.5831807999999996,G:3.5831807999999996)S10:0.7166361599999997)S9:0.859963392)S5:3.7563200962559984)S4:1.7832200896511985,B:10.699320537907196)S3:2.139864107581438)#H1:2.5678369290977265::0.4,A:15.407021574586361)S2:3.08140431491727,#H1:5.649241244014997::0.6)S1:81.51157411049637);"
    ],
    [
        "(Z:100.0,(((((P:1.0)#H1:1.4883199999999999::0.4,J:2.48832)S13:3.7034164223999992,(H:3.5831807999999996,G:3.5831807999999996)S12:2.6085556223999995)S4:15.99437464500436,A:22.186111067404358)S2:4.437222213480872,(((((L:1.728,M:1.728)S14:3.4317803519999996,(F:4.299816959999999,(K:2.0736)#H2:2.2262169599999995::0.35)S15:0.859963392)S11:3.7563200962559984,D:8.916100448255998)S9:1.7832200896511985,((N:1.44,(#H1:0.19999999999999996::0.6,O:1.2)S17:0.24)S16:1.5459839999999998,I:2.9859839999999997)S10:7.713336537907196)S5:7.789105351596435,((B:12.839184645488634,C:12.839184645488634)S8:2.5678369290977265,(E:7.430083706879999,#H2:5.356483706879999::0.65)S7:7.976937867706362)S6:3.08140431491727)S3:8.1349073913816)S1:73.37666671911477);",
        "(Z:100.0,((((F:5.159780351999999,((K:1.44,L:1.44)S14:1.5459839999999998)#H1:2.1737963519999997::0.4)S8:7.679404293488635,A:12.839184645488634)S4:9.346926421915724,(E:6.191736422399999)#H2:15.99437464500436::0.35)S2:4.437222213480872,(((C:8.916100448255998,#H1:5.930116448255998::0.6)S7:6.490921126330363,#H2:9.215285152186361::0.65)S5:3.08140431491727,(((((O:1.0,P:1.0)S13:2.5831807999999996,G:3.5831807999999996)S12:0.7166361599999997,(H:2.48832,((J:1.728,(M:1.2,N:1.2)S17:0.528)S16:0.3455999999999999,I:2.0736)S15:0.41472)S11:1.8114969599999995)S10:3.1302667468799994,D:7.430083706879999)S9:3.2692368310271975,B:10.699320537907196)S6:7.789105351596435)S3:8.1349073913816)S1:73.37666671911477);",
        "(Z:100.0,(((((((L:1.44,K:1.44)S17:0.28800000000000003,J:1.728)S14:5.702083706879999,(G:2.48832,F:2.48832)S15:4.941763706879999)S10:5.409100938608636,((P:1.0,O:1.0)S11:9.699320537907196,(((N:1.2,M:1.2)S16:2.3831808)#H2:0.7166361599999997::0.65)#H1:6.399503577907197::0.4)S9:2.139864107581438)S5:5.649241244014997,(((I:2.0736,H:2.0736)S12:6.842500448255998,(E:2.9859839999999997,D:2.9859839999999997)S13:5.930116448255998)S8:6.490921126330363,(C:5.159780351999999,B:5.159780351999999)S7:10.24724122258636)S6:3.08140431491727)S4:3.697685177900727,A:22.186111067404358)S3:4.437222213480872,(#H2:2.6085556223999995::0.35,#H1:1.8919194623999998::0.6)S2:20.431596858485232)S1:73.37666671911477);",
        "(Z:100.0,(((((((((((K:1.728,J:1.728)S14:1.8551807999999996,E:3.5831807999999996)S13:0.7166361599999997,D:4.299816959999999)S9:3.1302667468799994,((M:1.2,N:1.2)S17:0.24,L:1.44)S8:5.990083706879998)S7:1.486016741375999,B:8.916100448255998)S5:1.7832200896511985,((((I:2.0736,H:2.0736)S16:0.9123839999999999,(P:1.0,O:1.0)S15:1.9859839999999997)S12:2.1737963519999997,C:5.159780351999999)S11:1.0319560703999997,(G:2.48832,F:2.48832)S10:3.7034164223999992)S6:4.507584115507197)S4:2.139864107581438)#H2:2.5678369290977265::0.35)#H1:3.08140431491727::0.4,A:18.48842588950363)S3:3.697685177900727,#H1:6.779089492817997::0.6)S2:4.437222213480872,#H2:13.784148635396596::0.65)S1:73.37666671911477);"
    ],
    [
        "(Z:100.0,(((D:6.191736422399999,(M:1.44)#H1:4.751736422399999::0.4)S4:4.507584115507197,((L:1.728)#H2:0.7603199999999999::0.35,J:2.48832)S3:8.211000537907196)S2:27.638279386567532,((((P:1.0,O:1.0)S18:0.19999999999999996,N:1.2)S17:20.98611106740436,((((#H2:1.8551807999999996::0.65,G:3.5831807999999996)S16:0.7166361599999997,F:4.299816959999999)S15:3.1302667468799994,(E:5.159780351999999,(K:2.0736)#H3:3.0861803519999995::0.29999999999999993)S14:2.2703033548799993)S13:7.976937867706362,(#H1:7.476100448255998::0.6,#H3:6.842500448255998::0.7000000000000001)S12:6.490921126330363)S11:6.779089492817997)S10:9.761888869657916,((B:18.48842588950363,A:18.48842588950363)S9:8.1349073913816,(C:12.839184645488634,(I:2.9859839999999997,H:2.9859839999999997)S8:9.853200645488634)S7:13.784148635396596)S6:5.324666656177044)S5:6.389599987412456)S1:61.66240007552527);",
        "(Z:100.0,(((((A:10.699320537907196,((F:2.48832,G:2.48832)S13:6.427780448255998,B:8.916100448255998)S12:1.7832200896511985)S11:2.139864107581438)#H1:2.5678369290977265::0.4,(N:1.2,M:1.2)S10:14.207021574586362)S5:16.54097836247591,((L:1.44,K:1.44)S7:20.746111067404357,((((D:3.5831807999999996)#H2:0.7166361599999997::0.35,(H:2.0736,I:2.0736)S17:2.2262169599999995)S14:3.1302667468799994,(#H2:2.6085556223999995::0.65,(J:1.728,(O:1.0,P:1.0)S18:0.728)S16:4.463736422399999)S15:1.2383472844799996)S9:11.058342182623633,(E:2.9859839999999997)#H3:15.502441889503631::0.29999999999999993)S8:3.697685177900727)S4:9.761888869657916)S2:6.389599987412456,((#H3:2.1737963519999997::0.7000000000000001,C:5.159780351999999)S6:21.463552928885232,#H1:13.784148635396596::0.6)S3:11.7142666435895)S1:61.66240007552527);",
        "(Z:100.0,((((B:18.48842588950363,(((((K:2.0736,(P:1.0)#H2:1.0735999999999999::0.65)S17:1.5095807999999997)#H1:3.846902906879999::0.4,C:7.430083706879999)S12:3.2692368310271975,(((J:2.48832,I:2.48832)S15:3.7034164223999992,D:6.191736422399999)S14:2.7243640258559987,(L:1.728)#H3:7.188100448255998::0.29999999999999993)S13:1.7832200896511985)S9:4.707701036679165,((N:1.44,M:1.44)S16:3.7197803519999995,E:5.159780351999999)S10:10.24724122258636)S8:3.08140431491727)S7:3.697685177900727,(H:2.9859839999999997,(O:1.2,#H2:0.19999999999999996::0.35)S18:1.7859839999999998)S6:19.20012706740436)S3:9.761888869657916,(A:26.62333328088523,((G:4.299816959999999,F:4.299816959999999)S11:8.539367685488635,#H1:9.256003845488635::0.6)S5:13.784148635396596)S4:5.324666656177044)S2:6.389599987412456,#H3:36.60959992447473::0.7000000000000001)S1:61.66240007552527);",
        "(Z:100.0,(((((((A:6.191736422399999,(N:1.2,M:1.2)S18:4.991736422399999)S17:4.507584115507197,((F:2.9859839999999997,(H:2.0736,I:2.0736)S9:0.9123839999999999)S8:4.4440997068799994)#H3:3.2692368310271975::0.29999999999999993)S16:4.707701036679165,((B:5.159780351999999,C:5.159780351999999)S15:7.679404293488635,(D:4.299816959999999,((P:1.0,O:1.0)S14:2.5831807999999996,E:3.5831807999999996)S13:0.7166361599999997)S12:8.539367685488635)S11:2.5678369290977265)S10:3.08140431491727,(#H3:1.486016741375999::0.7000000000000001,(G:2.48832,(J:1.728,(K:1.44,L:1.44)S7:0.28800000000000003)S6:0.7603199999999999)S5:6.427780448255998)S4:9.572325441247633)S3:3.697685177900727)#H2:4.437222213480872::0.35)#H1:11.7142666435895::0.4,(#H1:5.324666656177044::0.6,#H2:9.761888869657916::0.65)S2:6.389599987412456)S1:61.66240007552527);"
    ],
    [
        "(Z:100.0,((((((O:1.2)#H1:3.099816959999999::0.4,F:4.299816959999999)S17:4.616283488255998,D:8.916100448255998)S15:3.9230841972326367,((N:1.44)#H2:5.990083706879998::0.35,(L:2.0736)#H3:5.356483706879999::0.29999999999999993)S14:5.409100938608636)S7:25.498415278986094,((M:1.728,(P:1.0)#H4:0.728::0.2499999999999999)S16:8.971320537907197,C:10.699320537907196)S6:27.638279386567532)S3:16.868543966768875,((((((G:3.5831807999999996,#H1:2.3831808::0.6)S18:1.5765995519999998,(H:2.9859839999999997,I:2.9859839999999997)S19:2.1737963519999997)S13:13.328645537503633,A:18.48842588950363)S11:8.1349073913816,(E:6.191736422399999,#H4:5.191736422399999::0.7500000000000001)S10:20.431596858485232)S9:5.324666656177044,((K:2.48832,J:2.48832)S12:19.69779106740436,#H2:20.746111067404357::0.65)S8:9.761888869657916)S5:14.057119972307401,(B:15.407021574586361,#H3:13.33342157458636::0.7000000000000001)S4:30.598098334783316)S2:9.20102398187393)S1:44.793856108756394);",
        "(Z:100.0,((((F:4.299816959999999)#H2:14.188608929503632::0.65)#H1:19.8491740349711::0.4,(((B:12.839184645488634,((((N:1.2,O:1.2)S19:0.8735999999999999,K:2.0736)S18:3.0861803519999995,#H2:0.859963392::0.35)S17:1.0319560703999997,E:6.191736422399999)S16:6.647448223088635)S15:2.5678369290977265,(H:2.9859839999999997,(J:2.48832,I:2.48832)S14:0.4976639999999999)S13:12.42103757458636)S12:16.54097836247591,#H1:13.459574047558643::0.6)S11:6.389599987412456)S10:16.868543966768875,((A:26.62333328088523,((((M:1.44)#H3:0.28800000000000003::0.29999999999999993,L:1.728)S9:8.971320537907197,(#H3:5.990083706879998::0.7000000000000001,(P:1.0)#H4:6.430083706879999::0.2499999999999999)S8:3.2692368310271975)S7:11.486790529497162,(D:8.916100448255998,C:8.916100448255998)S6:13.27001061914836)S5:4.437222213480872)S4:19.381786628484445,(G:3.5831807999999996,#H4:2.5831807999999996::0.7500000000000001)S3:42.421939109369674)S2:9.20102398187393)S1:44.793856108756394);",
        "(Z:100.0,((M:1.2,N:1.2)S2:54.0061438912436,(A:46.005119909369675,(((J:1.728,(P:1.0,O:1.0)S19:0.728)S8:30.219999937062273,(L:1.44,K:1.44)S7:30.507999937062273)S5:6.389599987412456,(((B:15.407021574586361,((I:2.0736)#H1:3.0861803519999995::0.4,((E:3.5831807999999996,(H:2.48832)#H3:1.0948607999999997::0.7000000000000001)S18:0.7166361599999997)#H2:0.859963392::0.35)S14:10.24724122258636)S11:6.779089492817997,(((C:10.699320537907196,(#H2:1.8919194623999998::0.65)#H4:4.507584115507197::0.2499999999999999)S15:2.139864107581438,((G:2.9859839999999997,F:2.9859839999999997)S17:5.930116448255998,#H3:6.427780448255998::0.29999999999999993)S16:3.9230841972326367)S13:5.649241244014997,#H4:12.296689467103633::0.7500000000000001)S12:3.697685177900727)S10:4.437222213480872,(D:7.430083706879999,#H1:5.356483706879999::0.6)S9:19.193249574005232)S6:11.7142666435895)S4:7.667519984894945)S3:9.20102398187393)S1:44.793856108756394);",
        "(Z:100.0,((((((((P:1.0,O:1.0)S15:3.2998169599999994,D:4.299816959999999)S12:3.1302667468799994,(G:2.9859839999999997,(H:2.0736,I:2.0736)S16:0.9123839999999999)S13:4.4440997068799994)S10:1.486016741375999,(((M:1.2,N:1.2)S19:0.528,J:1.728)S17:0.7603199999999999,(L:1.44,K:1.44)S18:1.04832)S11:6.427780448255998)S9:1.7832200896511985)#H2:2.139864107581438::0.35,(A:6.191736422399999,(E:3.5831807999999996,F:3.5831807999999996)S14:2.6085556223999995)S8:6.647448223088635)S6:5.649241244014997)#H1:36.717718001739975::0.4,(((#H1:8.1349073913816::0.6,(((C:5.159780351999999,B:5.159780351999999)S7:10.24724122258636,#H2:4.707701036679165::0.65)S5:6.779089492817997)#H4:4.437222213480872::0.2499999999999999)S4:5.324666656177044)#H3:14.057119972307401::0.29999999999999993,(#H3:6.389599987412456::0.7000000000000001,#H4:16.151488857070373::0.7500000000000001)S3:7.667519984894945)S2:9.20102398187393)S1:44.793856108756394);"
    ],
    [
        "(Z:100.0,((((C:22.186111067404358,(D:15.407021574586361)#H1:6.779089492817997::0.4)S10:16.151488857070373,(#H1:16.54097836247591::0.6,(H:3.5831807999999996)#H2:28.364819137062273::0.35)S9:6.389599987412456)S4:27.90977274501759,((((F:5.159780351999999)#H3:1.0319560703999997::0.29999999999999993,E:6.191736422399999)S16:4.507584115507197,((L:2.0736,K:2.0736)S18:6.842500448255998,((N:1.2)#H4:6.230083706879999::0.2499999999999999,#H3:2.2703033548799993::0.7000000000000001)S17:1.486016741375999)S15:1.7832200896511985)S8:35.30579937146248,(B:26.62333328088523,(I:2.9859839999999997,(M:1.44)#H5:1.5459839999999998::0.19999999999999984)S11:23.637349280885232)S7:19.381786628484445)S5:20.242252760122646)S3:13.249474533898464,(A:55.206143891243606,((#H2:9.256003845488635::0.65,(G:4.299816959999999,(#H5:0.28800000000000003::0.8000000000000002,(P:1.0,O:1.0)S20:0.728)S19:2.5718169599999996)S14:8.539367685488635)S12:5.649241244014997,(J:2.48832,#H4:1.28832::0.7500000000000001)S13:16.00010588950363)S6:36.717718001739975)S2:24.29070331214718)S1:20.503152796609214);",
        "(Z:100.0,(((((D:7.430083706879999,((N:1.2)#H2:2.3831808::0.35)#H1:3.846902906879999::0.4)S20:3.2692368310271975,(I:2.9859839999999997,H:2.9859839999999997)S19:7.713336537907196)S18:4.707701036679165,#H1:11.823840774586362::0.6)S17:22.93057834988837,((E:6.191736422399999)#H4:25.756263514662276::0.7500000000000001)#H3:6.389599987412456::0.29999999999999993)S16:41.159247278916055,((A:55.206143891243606,(((F:5.159780351999999,(J:2.48832,((M:1.44)#H5:0.6335999999999999::0.19999999999999984,K:2.0736)S15:0.41472)S14:2.6714603519999995)S13:7.679404293488635,(#H2:3.099816959999999::0.65,G:4.299816959999999)S12:8.539367685488635)S11:33.16593526388104,((#H4:12.296689467103633::0.2499999999999999,(B:8.916100448255998,C:8.916100448255998)S10:9.572325441247633)S9:8.1349073913816,((#H5:0.28800000000000003::0.8000000000000002,L:1.728)S8:20.458111067404356,(O:1.0,P:1.0)S7:21.186111067404358)S6:4.437222213480872)S5:19.381786628484445)S4:9.20102398187393)S3:11.041228778248716,#H3:34.299372732430044::0.7000000000000001)S2:13.249474533898464)S1:20.503152796609214);",
        "(Z:100.0,(((((J:2.9859839999999997)#H2:19.20012706740436::0.65,((N:1.2)#H4:0.528::0.7500000000000001)#H3:20.458111067404356::0.7000000000000001)S8:16.151488857070373)#H1:16.868543966768875::0.4,((((L:1.44,M:1.44)S20:3.7197803519999995,(O:1.0,P:1.0)S19:4.159780351999999)S17:2.2703033548799993,((K:2.0736)#H5:2.2262169599999995::0.19999999999999984,G:4.299816959999999)S16:3.1302667468799994)S11:19.193249574005232,A:26.62333328088523)S5:28.582810610358376)S3:24.29070331214718,(((E:10.699320537907196,(((#H5:0.41472::0.8000000000000002,#H3:0.7603199999999999::0.29999999999999993)S18:3.7034164223999992,#H4:4.991736422399999::0.2499999999999999)S15:2.7243640258559987,F:8.916100448255998)S14:1.7832200896511985)S7:35.30579937146248,(((C:12.839184645488634,D:12.839184645488634)S13:2.5678369290977265,(I:3.5831807999999996,H:3.5831807999999996)S12:11.823840774586362)S10:16.54097836247591,(#H2:15.502441889503631::0.35,B:18.48842588950363)S9:13.459574047558643)S6:14.057119972307401)S4:20.242252760122646,#H1:27.90977274501759::0.6)S2:13.249474533898464)S1:20.503152796609214);",
        "(Z:100.0,(((((((K:1.728,(L:1.44,(P:1.0,O:1.0)S20:0.43999999999999995)S19:0.28800000000000003)S17:1.2579839999999998,(G:2.48832,H:2.48832)S18:0.4976639999999999)S16:0.5971967999999999)#H3:28.364819137062273::0.29999999999999993,(#H3:23.04015248088523::0.7000000000000001,((A:18.48842588950363,((((F:4.299816959999999)#H4:0.859963392::0.2499999999999999,(I:2.0736,J:2.0736)S15:3.0861803519999995)S11:7.679404293488635,C:12.839184645488634)S10:2.5678369290977265,B:15.407021574586361)S9:3.08140431491727)S8:3.697685177900727,(D:7.430083706879999)#H5:14.75602736052436::0.19999999999999984)S7:4.437222213480872)S6:5.324666656177044)S5:6.389599987412456)#H2:16.868543966768875::0.35)#H1:24.29070331214718::0.4,(#H1:11.041228778248716::0.6,(#H2:7.667519984894945::0.65,(#H5:3.2692368310271975::0.8000000000000002,((M:1.2,N:1.2)S14:7.716100448255998,(#H4:1.8919194623999998::0.7500000000000001,E:6.191736422399999)S13:2.7243640258559987)S12:1.7832200896511985)S4:35.30579937146248)S3:20.242252760122646)S2:13.249474533898464)S1:20.503152796609214);"
    ]
]

alleles_per_pop = 1
loci_count = 10
mutation = 50
recombination = 50
locus_length = 500000
ms_prefix = "/home/ehs3/pop-gen-vs-phylo/bin/ms/ms"
# ms_prefix = "ms"

phylonet_max_reticulation = 2

manual_networks = []

for network_strings in manual_network_strings: # Iterate over difficulty blocks
    network_pairs = []
    for network_string in network_strings: # Iterate over individual network strings
        network = parse_rich_newick(network_string) # Parse string into network object
        
        # Convert population names to positive integers
        population_map = {} # Maps old population names to new integers
        population_map_counter = 1
        for node in network.nodes:
            if "population" in network.nodes[node]: # Loop over nodes with population key (leaves)
                node_pop = network.nodes[node]["population"]
                if node_pop not in population_map:
                    population_map[node_pop] = population_map_counter # Create new entry
                    population_map_counter += 1
                network.nodes[node]["population"] = population_map[node_pop] # Replace old name with new one

        # Reduce edge weights by dividing by 1000
        for edge in network.edges:
            if "length" in network.edges[edge]:
                network.edges[edge]["length"] /= 1000

        add_BirthDeath_time_tags(network) # Add time tags to network object

        network_cmd = generate_ms_command(network, alleles_per_pop, loci_count, mutation, recombination, locus_length, ms_prefix=ms_prefix) # Generate ms command
        
        ms_data = call_ms(network_cmd)

        network_pairs.append([network, network_cmd, ms_data])
    manual_networks.append(network_pairs)

base = "/home/ehs3/pop-gen-vs-phylo/manual_data"

create_dir(base)

top_level = ["input", "networks", "output"]
methods = ["gtmix", "treemix", "phylonet_mcmc_bimarkers", "phylonet_mle_bimarkers"]

for d, network_set in enumerate(manual_networks):
    # Build directory structure
    difficulty_base = base + "/d" + str(d)
    create_dir(difficulty_base)

    for name in top_level:
        create_dir(difficulty_base + "/" + name)
    for name in methods:
        create_dir(difficulty_base + "/input/" + name)
        create_dir(difficulty_base + "/output/" + name)
    
    for i, network_data in enumerate(network_set):
        # Save network using pickle
        pickle.dump(network_data[0], open(f'{difficulty_base}/networks/{i}.p', 'wb'))

        # Write GTmix input
        write_GTmix_input(network_data[2], f'{difficulty_base}/input/gtmix/{i}/')

        # Write TreeMix input
        write_TreeMix_input(network_data[2], f'{difficulty_base}/input/treemix/{i}.gz')

        # Write PhyloNet input
        bimarker_nexus, bimarker_taxa, bimarker_taxon_map = build_bimarker_nexus(network_data[2])
        MCMC_BiMarkers_input = build_MCMC_BiMarkers_input(bimarker_nexus, bimarker_taxa, bimarker_taxon_map, max_reticulation=phylonet_max_reticulation)
        MLE_BiMarkers_input = build_MLE_BiMarkers_input(bimarker_nexus, bimarker_taxon_map, max_reticulation=phylonet_max_reticulation)
        write_input(MCMC_BiMarkers_input, f'{difficulty_base}/input/phylonet_mcmc_bimarkers/{i}.nex')
        write_input(MLE_BiMarkers_input, f'{difficulty_base}/input/phylonet_mle_bimarkers/{i}.nex')